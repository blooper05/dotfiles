#!/bin/bash

readonly AIRPORT_PATH='/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport'
readonly INFO=($($AIRPORT_PATH --getinfo | grep -E '^ *(agrCtlRSSI|state|lastTxRate|SSID):' | awk '{print $2}'))
readonly RSSI=${INFO[0]}
readonly STAT=${INFO[1]}
readonly RATE=${INFO[2]}
readonly SSID=${INFO[3]}
readonly SIGNALS=(▂ ▅ ▇)

if [[ ${#INFO[@]} -eq 0 ]]; then
  echo offline
  exit 1
fi

if [[ RATE -eq 0 ]]; then
  echo no_wifi
  exit 1
fi

for (( i = 0; i < ${#SIGNALS[@]}; i++ )); do
  if (( i == 0 && -100 < RSSI )) ||
     (( i == 1 &&  -80 < RSSI )) ||
     (( i == 2 &&  -50 < RSSI )); then
     signal="${signal}${SIGNALS[i]} "
  else
     signal="${signal}  "
  fi
done

echo -e "${SSID} ${RATE}Mbs ${signal}"
