#!/bin/bash

readonly BATTERY_DANGER=20

get_battery() {
  pmset -g ps | grep -o '[0-9]\+%'
}

is_charging() {
  pmset -g ps | grep -E '\<charging;' >/dev/null 2>&1
}

battery_with_color() {
  local battery color

  battery=$(get_battery | tr -d '%')

  if is_charging; then
    color=colour46
  elif [[ battery -lt BATTERY_DANGER ]]; then
    color=red
  else
    color=blue
  fi

  echo -e "#[fg=${color}]${battery}%#[default]"
}

battery_with_color
