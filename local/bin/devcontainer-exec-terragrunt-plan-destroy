#!/bin/bash

set -euo pipefail

terragrunt_dir="$1"
plan_file=.terraform/terraform.plan.out

devcontainer-exec terragrunt --terragrunt-working-dir="$terragrunt_dir" plan -destroy --out="$plan_file"

plan_output=$(devcontainer-exec terragrunt --terragrunt-working-dir="$terragrunt_dir" show --no-color "$plan_file")

tee >(pbcopy) <<EOF
<details>
<summary><code>❯ devcontainer-exec terragrunt --terragrunt-working-dir=$terragrunt_dir plan -destroy</code></summary>

\`\`\`hcl
$plan_output
\`\`\`
</details>
EOF
