#!/bin/bash

set -ex

brew outdated

read -r -p "Upgrade outdated packages now? (y/N): " answer || true

if [[ "$answer" =~ ^[Yy]$ ]]; then
	brew upgrade luajit neovim tree-sitter utf8proc --fetch-HEAD
	brew bundle --cleanup
fi

/usr/libexec/PlistBuddy -c "Add :EnvironmentVariables:DOCKER_CONFIG string $HOME/.config/docker" /opt/homebrew/opt/colima/homebrew.mxcl.colima.plist
/usr/libexec/PlistBuddy -c "Add :EnvironmentVariables:LIMA_HOME string $HOME/.local/share/lima" /opt/homebrew/opt/colima/homebrew.mxcl.colima.plist
/usr/libexec/PlistBuddy -c "Add :EnvironmentVariables:COLIMA_HOME string $HOME/.local/share/colima" /opt/homebrew/opt/colima/homebrew.mxcl.colima.plist

brew services restart colima

rm -rf "$HOME/.colima/"
rm -rf "$HOME/.docker/"

/usr/libexec/PlistBuddy -c "Add :EnvironmentVariables:OLLAMA_MODELS string $HOME/.local/share/ollama/models" /opt/homebrew/opt/ollama/homebrew.mxcl.ollama.plist

brew services restart ollama
