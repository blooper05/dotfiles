#!/bin/bash

set -euo pipefail

terragrunt_dir="$1"
tmpfile=$(mktemp)

devcontainer-exec terragrunt --terragrunt-working-dir="$terragrunt_dir" apply --no-color 2>&1 | tee "$tmpfile"

apply_output=$(cat "$tmpfile")

tee >(pbcopy) <<EOF
<details>
<summary><code>❯ terragrunt --terragrunt-working-dir=$terragrunt_dir apply</code></summary>

\`\`\`hcl
$apply_output
\`\`\`
</details>
EOF
