#!/bin/bash

set -euo pipefail

terragrunt_dir="$1"
tmpfile=$(mktemp)

devcontainer-exec terragrunt --working-dir="$terragrunt_dir" run --all destroy --queue-include-external --no-color 2>&1 | tee "$tmpfile"

destroy_output=$(cat "$tmpfile")

tee >(pbcopy) <<EOF
<details>
<summary><code>â¯ terragrunt --working-dir=$terragrunt_dir destroy</code></summary>

\`\`\`hcl
$destroy_output
\`\`\`
</details>
EOF

devcontainer-exec terragrunt --working-dir="$terragrunt_dir" run --all state list --queue-include-external
